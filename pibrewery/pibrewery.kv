#:kivy 1.9
#:import chain itertools.chain
#:import Clock kivy.clock.Clock

ScreenManagement:
    id: sm
    name: 'screen manager'
    MainScreen:
    BrewingScreen
    FermentationScreen:

<Graph@Widget>:
    max: 100
    min: 0
    values: []
    canvas:
        Color:
            rgba: 0.8, 0.1,0.1, .5
        Line:
            width: 10
            points: [0, 65, self.width, 65 ]
        Color:
            rgba: 0.1, 0.6,0.8, 1
        Line:
            width: 2
            points:
                list(chain(*
                [[
                self.x + x * self.width / len(self.values),
                self.y + (y-self.min) * self.height / (self.max - self.min)
                ] for x, y in enumerate(self.values)])) if self.values else []

<MainScreen>:
    id: main
    name: 'main'
    BoxLayout:
        orientation: 'vertical'
        padding: 20
        spacing: 20
        BoxLayout:
            id: layout
            spacing: 20
            Button:
                on_release: app.root.current = 'brewing'
                text: 'Brewing'
                font_size: 50
            Button:
                on_release: app.root.current = 'fermentation'
                text: 'Fermentation'
                font_size: 50
        Button:
            on_release: app.get_running_app().stop()
            text: 'Close'
            font_size: 50

<BrewingScreen>:
    name: 'brewing'
    Button:
        on_release: app.root.current = 'main'
        text: 'back to the home screen'
        font_size: 50

<FermentationScreen>:
    id: ferm_screen
    name: 'fermentation'
    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            size_hint: 1, 0.2
            Label:
                text: 'Temperature'
            Label:
                text: app.current_temperature
            Label:
                text: 'F'
            ToggleButton:
                text: 'Start'
                on_state:
                    if self.state == 'down':Clock.schedule_interval(app.update_fermentation_plot, 1)
                    else:Clock.unschedule(app.update_fermentation_plot)
            Button:
                on_release: app.root.current = 'main'
                text: 'Home'
        Graph:
            id: ferm_graph
            ylabel: 'Temperature'
            x_grid: True
            y_grid: True
            y_ticks_major: 5
            x_ticks_major: 10
            max: app.temperature_max
            min: app.temperature_min
            values: app.temperature_values
